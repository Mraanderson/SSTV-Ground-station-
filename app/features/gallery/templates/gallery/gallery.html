{% extends "base.html" %}
{% block content %}
<h1>Decoded Images</h1>

<div id="gallery-container">
  {% include "gallery/_gallery_items.html" %}
</div>

<script>
  let refreshInterval = 10000; // 10 seconds

  function refreshGallery() {
    if (document.visibilityState === "visible") {
      fetch("{{ url_for('gallery.gallery_partial') }}")
        .then(response => response.text())
        .then(html => {
          const container = document.querySelector("#gallery-container");
          container.innerHTML = html;
          container.querySelectorAll("img").forEach(img => {
            img.style.opacity = 0;
            img.onload = () => {
              img.style.transition = "opacity 0.5s";
              img.style.opacity = 1;
            };
          });
        })
        .catch(err => console.error("Gallery refresh failed:", err));
    }
  }

  setInterval(refreshGallery, refreshInterval);
</script>
{% endblock %}
