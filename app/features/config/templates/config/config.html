{% extends "base.html" %}
{% block content %}

<!-- Debug Panel -->
<div id="config-debug" style="background:#f8f9fa; padding:10px; border:1px solid #ccc; margin-bottom:1em;">
    <strong>Debug — Current Config:</strong><br>
    Latitude: {{ latitude }}<br>
    Longitude: {{ longitude }}<br>
    Elevation: {{ altitude }}<br>
    Timezone: {{ timezone }}
</div>

<!-- Saved Confirmation -->
<div id="save-confirm" style="display:none; background:#d4edda; padding:10px; border:1px solid #c3e6cb; margin-bottom:1em;">
    ✅ Config saved successfully
</div>

<form id="location-form" method="POST">
    <!-- Save button moved to top -->
    <button type="submit" id="save-location" class="btn btn-primary" style="margin-bottom:1em;">
        Save Location
    </button>

    <!-- Your existing map and form fields remain unchanged -->
    {{ super() }}
</form>

<!-- AJAX Save Script -->
<script>
document.getElementById('location-form').addEventListener('submit', function(e) {
    e.preventDefault();

    fetch(window.location.pathname, {
        method: 'POST',
        headers: { 'Accept': 'application/json' },
        body: new FormData(this)
    })
    .then(res => res.json())
    .then(data => {
        if (data.error) {
            alert('❌ ' + data.error);
            return;
        }

        // Update debug panel
        document.getElementById('config-debug').innerHTML =
            `<strong>Debug — Current Config:</strong><br>
             Latitude: ${data.latitude}<br>
             Longitude: ${data.longitude}<br>
             Elevation: ${data.elevation}<br>
             Timezone: ${data.timezone}`;

        // Show confirmation
        const confirmBox = document.getElementById('save-confirm');
        confirmBox.style.display = 'block';
        confirmBox.textContent = `✅ Config saved successfully at ${data.saved_time}`;

        // Hide after 3 seconds
        setTimeout(() => {
            confirmBox.style.display = 'none';
        }, 3000);
    })
    .catch(err => {
        alert('❌ Error saving config: ' + err);
    });
});
</script>

{% endblock %}
