<!-- Debug Panel -->
<div id="config-debug" style="background:#f8f9fa; padding:10px; border:1px solid #ccc; margin-bottom:1em;">
    <strong>Debug — Current Config:</strong><br>
    Latitude: {{ latitude }}<br>
    Longitude: {{ longitude }}<br>
    Elevation: {{ altitude }}<br>
    Timezone: {{ timezone }}
</div>

<!-- Saved Confirmation -->
<div id="save-confirm" style="display:none; background:#d4edda; padding:10px; border:1px solid #c3e6cb; margin-bottom:1em;">
    ✅ Config saved successfully
</div>

<!-- Location Form -->
<form id="location-form" method="POST">
    <!-- Save button at top -->
    <button type="submit" id="save-location" class="btn btn-primary" style="margin-bottom:1em;">
        Save Location
    </button>

    <div class="form-group">
        <label for="latitude">Latitude</label>
        <input type="text" id="latitude" name="latitude" class="form-control" value="{{ latitude }}">
    </div>

    <div class="form-group">
        <label for="longitude">Longitude</label>
        <input type="text" id="longitude" name="longitude" class="form-control" value="{{ longitude }}">
    </div>

    <div class="form-group">
        <label for="altitude">Elevation (m)</label>
        <input type="text" id="altitude" name="altitude" class="form-control" value="{{ altitude }}">
    </div>

    <div class="form-group">
        <label for="timezone">Timezone</label>
        <input type="text" id="timezone" name="timezone" class="form-control" value="{{ timezone }}">
    </div>
</form>

<!-- JavaScript for AJAX save + live debug update -->
<script>
document.getElementById('location-form').addEventListener('submit', function(e) {
    e.preventDefault();

    fetch(window.location.pathname, {
        method: 'POST',
        headers: { 'Accept': 'application/json' },
        body: new FormData(this)
    })
    .then(res => res.json())
    .then(data => {
        if (data.error) {
            alert('❌ ' + data.error);
            return;
        }

        // Update debug panel
        document.getElementById('config-debug').innerHTML =
            `<strong>Debug — Current Config:</strong><br>
             Latitude: ${data.latitude}<br>
             Longitude: ${data.longitude}<br>
             Elevation: ${data.elevation}<br>
             Timezone: ${data.timezone}`;

        // Show confirmation
        const confirmBox = document.getElementById('save-confirm');
        confirmBox.style.display = 'block';
        confirmBox.textContent = `✅ Config saved successfully at ${data.saved_time}`;

        // Hide after 3 seconds
        setTimeout(() => {
            confirmBox.style.display = 'none';
        }, 3000);
    })
    .catch(err => {
        alert('❌ Error saving config: ' + err);
    });
});
</script>
