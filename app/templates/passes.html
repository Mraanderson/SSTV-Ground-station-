{% extends "base.html" %}
{% block title %}Upcoming ISS Passes{% endblock %}

{% block content %}
<div class="card p-3 bg-secondary text-light">

  <!-- Header with toggle -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Upcoming ISS Passes (Next 24 Hours)</h2>
    <div class="form-check form-switch">
      <input class="form-check-input" type="checkbox" id="timeToggle">
      <label class="form-check-label" for="timeToggle">Show in local time</label>
    </div>
  </div>

  {% if message %}
    <div class="alert alert-warning">{{ message }}</div>
  {% elif passes %}
    <table class="table table-dark table-striped table-hover align-middle" id="passesTable">
      <thead>
        <tr>
          <th>AOS</th>
          <th>LOS</th>
          <th>Max Elev (Â°)</th>
          <th>Duration (s)</th>
        </tr>
      </thead>
      <tbody>
        {% for p in passes %}
        <tr>
          <!-- Force safe UTC format for JS parsing -->
          <td data-utc="{{ p.aos.strftime('%Y-%m-%dT%H:%M:%SZ') }}">{{ p.aos.strftime('%Y-%m-%d %H:%M:%S') }}</td>
          <td data-utc="{{ p.los.strftime('%Y-%m-%dT%H:%M:%SZ') }}">{{ p.los.strftime('%Y-%m-%d %H:%M:%S') }}</td>
          <td>{{ '%.1f'|format(p.max_elev) }}</td>
          <td>{{ p.duration }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="text-muted">No ISS passes found in the next 24 hours.</p>
  {% endif %}
</div>

<!-- Timezone toggle script -->
<script>
document.getElementById('timeToggle').addEventListener('change', function() {
  const rows = document.querySelectorAll('#passesTable tbody tr');
  rows.forEach(row => {
    row.querySelectorAll('td[data-utc]').forEach(cell => {
      const utcString = cell.getAttribute('data-utc');
      const date = new Date(utcString);
      if (this.checked) {
        // Local time
        cell.textContent = date.toLocaleString();
      } else {
        // Back to UTC
        cell.textContent = utcString.replace('T', ' ').replace('Z', '');
      }
    });
  });
});
</script>
{% endblock %}
