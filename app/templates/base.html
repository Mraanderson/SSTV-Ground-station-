<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}SSTV Groundstation{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  {% block head %}{% endblock %}
</head>
<body class="{% if current_app.config.get('THEME') == 'dark' %}dark-mode{% endif %}">

<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="{{ url_for('main.index') }}">SSTV Groundstation</a>
    <div class="d-flex">
      <button id="dark-mode-toggle" class="btn btn-outline-secondary btn-sm">
        ðŸŒ™ Dark Mode
      </button>
    </div>
  </div>
</nav>

<div class="container mt-4">
  {% block content %}{% endblock %}
</div>

<script>
  const toggleBtn = document.getElementById('dark-mode-toggle');

  // Load saved preference from localStorage
  if (localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark-mode');
  }

  toggleBtn.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    localStorage.setItem('darkMode', isDark);

    // Optional: Save to config via AJAX
    fetch('{{ url_for("config.config_page") }}', {
      method: 'POST',
      headers: { 'Accept': 'application/json' },
      body: new FormData(Object.assign(document.createElement('form'), {
        theme: isDark ? 'dark' : 'light',
        latitude: '{{ current_app.config.get("LATITUDE", "") }}',
        longitude: '{{ current_app.config.get("LONGITUDE", "") }}',
        altitude: '{{ current_app.config.get("ALTITUDE_M", "") }}',
        timezone: '{{ current_app.config.get("TIMEZONE", "") }}'
      }))
    });
  });
</script>

{% block scripts %}{% endblock %}
</body>
</html>
